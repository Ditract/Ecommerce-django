{% extends "base.html" %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'orders/css/order.css' %}">
{% endblock extra_css %}

{% block content %}
<main class="checkout-page">
  <div class="checkout-layout">
    <div class="checkout-form-column">
      <form method="post" class="checkout-form">
        {% csrf_token %}

        <section class="checkout-section">
          <h3>Dirección de Envío</h3>
          {% for field in address_form %}
            <div class="form-group">
              <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
              {{ field }}
              {% if field.errors %}
                {% for error in field.errors %}
                  <span class="form-error">{{ error }}</span>
                {% endfor %}
              {% endif %}
            </div>
          {% endfor %}
        </section>

        <section class="checkout-section">
          <h3>Método de Pago</h3>
          {% for field in payment_form %}
            <div class="form-group">
              <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
              {{ field }}
               {% if field.errors %}
                {% for error in field.errors %}
                  <span class="form-error">{{ error }}</span>
                {% endfor %}
              {% endif %}
            </div>
          {% endfor %}
        </section>

        <button type="submit" class="btn-primary">Confirmar y Pagar</button>
      </form>
    </div>

    <div class="order-summary-column">
      <div class="order-summary-card">
        <h3>Resumen del Pedido</h3>
        <ul class="summary-items">
          {% for item in cart.items.all %}
          <li class="summary-item">
            <div class="item-info">
              <span>{{ item.quantity }} x</span> {{ item.product.name }}
            </div>
            <div class="item-price">${{ item.product.price }}</div>
          </li>
          {% endfor %}
        </ul>
        <div class="summary-totals">
          <div class="total-row">
            <span class="label">Subtotal:</span>
            <span class="value">${{ cart.total }}</span>
          </div>
          <div class="total-row">
            <span class="label">Envío:</span>
            <span class="value">${{ shipping_cost }}</span>
          </div>
          <div class="total-row grand-total">
            <span class="label">Total:</span>
            <span class="value">${{ cart.total|add:shipping_cost }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %}